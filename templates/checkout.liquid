{% layout 'default' %}

<div class="container mx-auto px-4 py-12">
  <h1 class="text-3xl font-bold mb-8">{{ 'cart.checkout' | t }}</h1>
  
  <!-- Progress Indicator -->
  <div class="flex items-center mb-12">
    <div class="flex flex-col items-center text-primary">
      <div class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center mb-2">1</div>
      <span class="text-sm">{{ 'checkout.contact.title' | t }}</span>
    </div>
    <div class="flex-grow h-0.5 bg-primary"></div>
    
    <div class="flex flex-col items-center">
      <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mb-2">2</div>
      <span class="text-sm">{{ 'checkout.shipping.title' | t }}</span>
    </div>
    <div class="flex-grow h-0.5 bg-gray-200"></div>
    
    <div class="flex flex-col items-center">
      <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mb-2">3</div>
      <span class="text-sm">{{ 'checkout.payment.title' | t }}</span>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Checkout Form Steps -->
    <div class="lg:col-span-2 space-y-8">
      <!-- Step 1: Contact Information -->
      <div id="contact-step" class="p-6 bg-light rounded-lg shadow-sm">
        <h2 class="text-xl font-bold mb-6">{{ 'checkout.contact.title' | t }}</h2>
        <form id="contact-form" class="space-y-4">
          <div>
            <label for="email" class="block mb-1">{{ 'checkout.contact.email' | t }}</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              required 
              class="w-full border border-gray-300 p-2 rounded-none"
              placeholder="{{ 'checkout.contact.email_placeholder' | t }}"
            />
          </div>
          <div class="flex items-center">
            <input 
              type="checkbox" 
              id="create-account" 
              name="create-account"
              class="mr-2"
            />
            <label for="create-account" class="text-sm">{{ 'checkout.contact.create_account' | t }}</label>
          </div>
          <div class="text-sm text-text/70">
            {{ 'checkout.contact.points_info' | t }}
          </div>
          <button 
            type="button" 
            onclick="nextStep(2)"
            class="mt-4 bg-primary hover:bg-accent text-white py-2 px-6 rounded-none transition-colors"
          >
            {{ 'checkout.next' | t }}
            <svg class="ml-2 w-5 h-5 inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </form>
      </div>

      <!-- Step 2: Shipping Address -->
      <div id="shipping-step" class="p-6 bg-light rounded-lg shadow-sm hidden">
        <h2 class="text-xl font-bold mb-6">{{ 'checkout.shipping.title' | t }}</h2>
        <form id="shipping-form" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="first-name" class="block mb-1">{{ 'checkout.shipping.first_name' | t }}</label>
              <input 
                type="text" 
                id="first-name" 
                name="first-name" 
                required 
                class="w-full border border-gray-300 p-2 rounded-none"
              />
            </div>
            <div>
              <label for="last-name" class="block mb-1">{{ 'checkout.shipping.last_name' | t }}</label>
              <input 
                type="text" 
                id="last-name" 
                name="last-name" 
                required 
                class="w-full border border-gray-300 p-2 rounded-none"
              />
            </div>
          </div>
          <div>
            <label for="address" class="block mb-1">{{ 'checkout.shipping.address' | t }}</label>
            <input 
              type="text" 
              id="address" 
              name="address" 
              required 
              class="w-full border border-gray-300 p-2 rounded-none"
              placeholder="{{ 'checkout.shipping.address_placeholder' | t }}"
            />
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label for="city" class="block mb-1">{{ 'checkout.shipping.city' | t }}</label>
              <input 
                type="text" 
                id="city" 
                name="city" 
                required 
                class="w-full border border-gray-300 p-2 rounded-none"
              />
            </div>
            <div>
              <label for="state" class="block mb-1">{{ 'checkout.shipping.state' | t }}</label>
              <input 
                type="text" 
                id="state" 
                name="state" 
                required 
                class="w-full border border-gray-300 p-2 rounded-none"
              />
            </div>
            <div>
              <label for="zip" class="block mb-1">{{ 'checkout.shipping.zip' | t }}</label>
              <input 
                type="text" 
                id="zip" 
                name="zip" 
                required 
                class="w-full border border-gray-300 p-2 rounded-none"
              />
            </div>
          </div>
          <div>
            <label for="country" class="block mb-1">{{ 'checkout.shipping.country' | t }}</label>
            <select 
              id="country" 
              name="country" 
              required 
              class="w-full border border-gray-300 p-2 rounded-none"
            >
              <option value="">{{ 'checkout.shipping.select_country' | t }}</option>
              <option value="SA">{{ 'checkout.shipping.saudi_arabia' | t }}</option>
              <option value="AE">{{ 'checkout.shipping.uae' | t }}</option>
              <option value="EG">{{ 'checkout.shipping.egypt' | t }}</option>
              <option value="JO">{{ 'checkout.shipping.jordan' | t }}</option>
            </select>
          </div>
          <div class="flex items-center">
            <input 
              type="checkbox" 
              id="save-address" 
              name="save-address" 
              class="mr-2"
            />
            <label for="save-address" class="text-sm">{{ 'checkout.shipping.save_address' | t }}</label>
          </div>
          <div class="flex justify-between mt-6">
            <button 
              type="button" 
              onclick="prevStep(1)" 
              class="bg-transparent border border-gray-300 text-text py-2 px-6 rounded-none hover:bg-gray-100 transition-colors"
            >
              {{ 'checkout.back' | t }}
            </button>
            <button 
              type="button" 
              onclick="nextStep(3)"
              class="bg-primary hover:bg-accent text-white py-2 px-6 rounded-none transition-colors"
            >
              {{ 'checkout.next' | t }}
              <svg class="ml-2 w-5 h-5 inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </form>
      </div>

      <!-- Step 3: Payment Method -->
      <div id="payment-step" class="p-6 bg-light rounded-lg shadow-sm hidden">
        <h2 class="text-xl font-bold mb-6">{{ 'checkout.payment.title' | t }}</h2>
        
        <div class="space-y-6">
          <div class="flex items-center">
            <input 
              type="radio" 
              id="credit-card" 
              name="payment-method" 
              value="credit-card" 
              checked 
              class="mr-2"
            />
            <label for="credit-card" class="font-medium">{{ 'checkout.payment.credit_card' | t }}</label>
          </div>
          
          <div class="pl-6 space-y-4 ml-4">
            <div>
              <label for="card-number" class="block mb-1">{{ 'checkout.payment.card_number' | t }}</label>
              <input 
                type="text" 
                id="card-number" 
                name="card-number" 
                class="w-full border border-gray-300 p-2 rounded-none"
                placeholder="1234 5678 9012 3456"
                required
              />
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="expiry-date" class="block mb-1">{{ 'checkout.payment.expiry_date' | t }}</label>
                <input 
                  type="text" 
                  id="expiry-date" 
                  name="expiry-date" 
                  class="w-full border border-gray-300 p-2 rounded-none"
                  placeholder="MM / YY"
                  required
                />
              </div>
              <div>
                <label for="cvv" class="block mb-1">{{ 'checkout.payment.cvv' | t }}</label>
                <input 
                  type="text" 
                  id="cvv" 
                  name="cvv" 
                  class="w-full border border-gray-300 p-2 rounded-none"
                  placeholder="123"
                  required
                />
              </div>
            </div>
            <div>
              <label for="cardholder-name" class="block mb-1">{{ 'checkout.payment.cardholder_name' | t }}</label>
              <input 
                type="text" 
                id="cardholder-name" 
                name="cardholder-name" 
                class="w-full border border-gray-300 p-2 rounded-none"
                required
              />
            </div>
          </div>

          <div class="flex items-center">
            <input 
              type="radio" 
              id="paypal" 
              name="payment-method" 
              value="paypal" 
              class="mr-2"
            />
            <label for="paypal" class="font-medium">{{ 'checkout.payment.paypal' | t }}</label>
          </div>

          <div class="flex items-center">
            <input 
              type="radio" 
              id="apple-pay" 
              name="payment-method" 
              value="apple-pay" 
              class="mr-2"
            />
            <label for="apple-pay" class="font-medium">{{ 'checkout.payment.apple_pay' | t }}</label>
          </div>

          <div class="pt-4 border-t">
            <button 
              type="submit" 
              class="w-full bg-accent hover:bg-primary text-white py-3 px-4 rounded-none transition-colors"
            >
              {{ 'checkout.place_order' | t }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="lg:col-span-1 sticky top-20 bg-light p-6 rounded-lg shadow-sm">
      <h2 class="text-xl font-bold mb-4">{{ 'checkout.order_summary' | t }}</h2>
      <div class="space-y-4 mb-6">
        {% for item in cart.items %}
          <div class="flex justify-between text-sm">
            <span>{{ item.product_title }} x {{ item.quantity }}</span>
            <span>{{ item.price | money }} {{ shop.currency }}</span>
          </div>
        {% endfor %}
        <div class="pt-3 border-t flex justify-between font-bold">
          <span>{{ 'cart.total' | t }}</span>
          <span>{{ cart.total_price | money }} {{ shop.currency }}</span>
        </div>
      </div>
      <div class="border-t pt-4">
        <h3 class="font-medium mb-2">{{ 'checkout.saved_addresses.title' | t }}</h3>
        <select class="w-full border border-gray-300 p-2 rounded-none">
          <option>{{ 'checkout.saved_addresses.new' | t }}</option>
          <option>Jane Doe - 123 Main St, Riyadh</option>
          <option>John Smith - 456 Al-Olaya St, Jeddah</option>
        </select>
      </div>
    </div>
  </div>
</div>

<script>
  function nextStep(step) {
    document.getElementById('contact-step').classList.add('hidden');
    document.getElementById('shipping-step').classList.add('hidden');
    document.getElementById('payment-step').classList.add('hidden');
    if (step === 2) {
      document.getElementById('shipping-step').classList.remove('hidden');
    } else if (step === 3) {
      document.getElementById('payment-step').classList.remove('hidden');
    }
    updateProgress(step);
  }

  function prevStep(step) {
    document.getElementById('contact-step').classList.add('hidden');
    document.getElementById('shipping-step').classList.add('hidden');
    document.getElementById('payment-step').classList.add('hidden');
    if (step === 1) {
      document.getElementById('contact-step').classList.remove('hidden');
    } else if (step === 2) {
      document.getElementById('shipping-step').classList.remove('hidden');
    }
    updateProgress(step);
  }

  function updateProgress(currentStep) {
    const steps = document.querySelectorAll('.progress-step');
    steps.forEach((step, index) => {
      if (index + 1 <= currentStep) {
        step.classList.add('bg-primary', 'text-white');
        if (index + 1 < currentStep) {
          step.innerHTML = `
            <svg class="w-6 h-6 mx-auto" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 13L9 17L19 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`;
        }
      } else {
        step.classList.remove('bg-primary', 'text-white');
        step.innerHTML = (index + 1).toString();
      }
    });
  }

  // Initialize progress bar
  function initProgress() {
    const steps = ['Contact', 'Shipping', 'Payment'];
    const progressContainer = document.querySelector('.progress-steps');
    progressContainer.innerHTML = '';
    steps.forEach((step, index) => {
      const div = document.createElement('div');
      div.className = 'flex flex-col items-center';
      div.innerHTML = `
        <div class="progress-step w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mb-2">${index + 1}</div>
        <span class="text-sm">${step}</span>
      `;
      progressContainer.appendChild(div);
    });
  }

  window.addEventListener('DOMContentLoaded', () => {
    initProgress();
    document.getElementById('contact-step').classList.remove('hidden');
  });
</script>